<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Leagueoverseer by allejo</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Leagueoverseer</h1>
        <h2>A BZFlag plug-in used by leagues in order to automatically relay information from BZFlag servers to the league site, such as team names and automatic match reports.</h2>
        <a href="https://github.com/allejo/leagueOverSeer" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="league-overseer" class="anchor" href="#league-overseer"><span class="octicon octicon-link"></span></a>League Overseer</h1>

<p>This is a BZFlag plug-in that allows official league servers to communicate with the league website to automatically transmit match reports and handle team data.</p>

<h2>
<a name="table-of-contents" class="anchor" href="#table-of-contents"><span class="octicon octicon-link"></span></a>Table of Contents</h2>

<ul>
<li>
<p><a href="#authors">Authors</a></p>

<ul>
<li><a href="#thanks-to">Thanks to</a></li>
</ul>
</li>
<li>
<p><a href="#compiling">Compiling</a></p>

<ul>
<li><p><a href="#requirements">Requirements</a></p></li>
<li><p><a href="#how-to-compile">How to Compile</a></p></li>
<li><p><a href="#updating-the-plugin">Updating the Plugin</a></p></li>
<li><p><a href="#common-issues">Common Issues</a></p></li>
</ul>
</li>
<li>
<p><a href="#server-details">Server Details</a></p>

<ul>
<li><p><a href="#how-to-use">How to Use</a></p></li>
<li><p><a href="#custom-slash-commands">Custom Slash Commands</a></p></li>
<li><p><a href="#deprecated-features">Deprecated Features</a></p></li>
<li><p><a href="#configuration-file-options">Configuration File Options</a></p></li>
</ul>
</li>
<li><p><a href="#league-websites">League Websites</a></p></li>
<li><p><a href="#code-hosting">Code Hosting</a></p></li>
<li><p><a href="#license">License</a></p></li>
</ul><h2>
<a name="authors" class="anchor" href="#authors"><span class="octicon octicon-link"></span></a>Authors</h2>

<ul>
<li><p>Vladimir "allejo" Jimenez</p></li>
<li><p>Ned "mdskpr" Anderson</p></li>
</ul><h3>
<a name="thanks-to" class="anchor" href="#thanks-to"><span class="octicon octicon-link"></span></a>Thanks to</h3>

<p>Thank you to all the amazing people who have contributed making this project possible.</p>

<ul>
<li><p><a href="https://github.com/kongr45gpen">alezakos</a></p></li>
<li><p><a href="https://github.com/achoopic">apeman</a></p></li>
<li><p><a href="https://github.com/blast007">blast</a></p></li>
<li><p><a href="https://github.com/JMakey">BulletCatcher</a></p></li>
<li><p><a href="https://github.com/JeffM2501">JeffM</a></p></li>
<li><p>... and all the beta testers</p></li>
</ul><h2>
<a name="compiling" class="anchor" href="#compiling"><span class="octicon octicon-link"></span></a>Compiling</h2>

<h3>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h3>

<ul>
<li><p>BZFlag 2.4.3+ (after Feb 16th 2014)</p></li>
<li><p>C++11</p></li>
<li>
<p>JSON Library</p>

<ul>
<li><p>libjson0-dev (Debian/Ubuntu)</p></li>
<li><p>json-c-devel (Fedora Linux)</p></li>
</ul>
</li>
</ul><h3>
<a name="how-to-compile" class="anchor" href="#how-to-compile"><span class="octicon octicon-link"></span></a>How to Compile</h3>

<ol>
<li>
<p>Check out the 2.4.x BZFlag source code from GitHub, if you do not already have it on your server. If you are still using SVN, it is recommended you switch to using Git because all future development of BZFlag will use Git.</p>

<p><code>git clone -b v2_4_x https://github.com/BZFlag-Dev/bzflag-import-3.git bzflag</code></p>
</li>
<li>
<p>Go into the newly checked out source code and then the plugins directory.</p>

<p><code>cd bzflag/plugins</code></p>
</li>
<li>
<p>Run a git clone of this repository from within the plugins directory. This should have created a new leagueOverSeer directory within the plugins directory. Notice, you will be checking out the 'release' branch will always contain the latest release of the plugin to allow for easy update. If you are running a test port and would like the latest development build, use the 'master' branch instead of 'release.'</p>

<p><code>git clone -b release https://github.com/allejo/leagueOverSeer.git</code></p>
</li>
<li>
<p>The latest BZFlag trunk will contain a script called 'addToBuild.sh' and it will allow you to add the plugin to the build system.</p>

<p><code>sh addToBuild.sh leagueOverSeer</code></p>
</li>
<li>
<p>Instruct the build system to generate a Makefile and then compile and install the plugin.</p>

<p><code>cd ..; ./autogen.sh; ./configure; make; make install;</code></p>
</li>
</ol><h3>
<a name="updating-the-plugin" class="anchor" href="#updating-the-plugin"><span class="octicon octicon-link"></span></a>Updating the Plugin</h3>

<ol>
<li><p>Go into the leagueOverSeer folder located in your plugins folder.</p></li>
<li>
<p>Pull the changes from Git.</p>

<p><code>git pull origin release</code></p>
</li>
<li>
<p>(Optional) If you have made local changes to any of the files from this project, you may receive conflict errors where you may resolve the conflicts yourself or you may simply overwrite your changes with whatever is in the repository, which is recommended. <em>If you have a conflict every time you update because of your local change, submit a pull request and it will be accepted, provided it's a reasonable change.</em></p>

<p><code>git reset --hard origin/release; git pull</code></p>
</li>
<li>
<p>Compile the changes.</p>

<p><code>make; make install;</code></p>
</li>
</ol><h3>
<a name="common-issues" class="anchor" href="#common-issues"><span class="octicon octicon-link"></span></a>Common Issues</h3>

<p>Issues may be worded differently depending on the operating system or compiler but here are some common compiling or runtime issues. If your issue is not listed here, please report it so a fix can be added to this documentation.</p>

<h4>
<a name="symbol-lookup-error" class="anchor" href="#symbol-lookup-error"><span class="octicon octicon-link"></span></a>Symbol Lookup Error</h4>

<pre><code>bzfs: symbol lookup error: leagueOverSeer.so: undefined symbol: json_tokener_parse
</code></pre>

<p>This error occurs when the plugin was not linked to the JSON library when it was compiled. If you are on Debian or Ubuntu, be sure you are using the provided "Makefile.am" file, which already links to the JSON library. If you are on another operating system, you need to link to the JSON library using the <code>-l</code> option in the <code>leagueOverSeer_la_LDFLAGS</code> section; for example, on Debian and Ubuntu, <code>-ljson</code> is used.</p>

<h4>
<a name="undeclared-identifier" class="anchor" href="#undeclared-identifier"><span class="octicon octicon-link"></span></a>Undeclared identifier</h4>

<pre><code>Use of undeclared identifier 'bz_isCountDownPaused'
</code></pre>

<p>or</p>

<pre><code>'bz_eGameResumeEvent' was not declared in this scope
</code></pre>

<p>This error occurs because the build of BZFlag you are using is outdated and the <em>bz_isCountDownPaused()</em> function or <em>bz_eGameResumeEvent</em> event did not exist at the time you checked out/cloned your copy of BZFlag. In order to compile this plugin, you are required to use the latest BZFlag trunk, which has been migrated to GitHub so using git is a requirement.</p>

<h3>
<a name="repository-branches" class="anchor" href="#repository-branches"><span class="octicon octicon-link"></span></a>Repository Branches</h3>

<p>This repository contains different branches mainly for historical purposes where only two branches are actually used.</p>

<h4>
<a name="active" class="anchor" href="#active"><span class="octicon octicon-link"></span></a>Active</h4>

<ul>
<li>
<p><strong>master</strong></p>

<p>This branch is where all of the development occurs and always contains the most up to date plugin, which may or may not be stable.</p>
</li>
<li>
<p><strong>release</strong></p>

<p>This branch contains the latest stable release of the plugin and should be used when compiling for a production server.</p>
</li>
</ul><h4>
<a name="abandoned" class="anchor" href="#abandoned"><span class="octicon octicon-link"></span></a>Abandoned</h4>

<ul>
<li>
<p><strong>C++98</strong></p>

<p>This branch contains abandoned code that followed the C++98 standards but was abandoned in favor of using the new C++11 features.</p>
</li>
<li>
<p><strong>matchOverSeer</strong></p>

<p>This branch contains the original code for the Match Overseer plugin used for OpenLeague. League Overseer was originally a fork of the this plugin.</p>
</li>
<li>
<p><strong>v1_0</strong></p>

<p>This branch contains the code for the 1.0 version of the plugin that used SQLite for information storage and had a lot of bugs.</p>
</li>
</ul><h2>
<a name="server-details" class="anchor" href="#server-details"><span class="octicon octicon-link"></span></a>Server Details</h2>

<h3>
<a name="how-to-use" class="anchor" href="#how-to-use"><span class="octicon octicon-link"></span></a>How to Use</h3>

<p>To use this plugin after it has been compiled, simply load the plugin via the configuration file.</p>

<p><code>-loadplugin /path/to/leagueOverSeer.so,/path/to/leagueOverSeer.cfg</code></p>

<h3>
<a name="custom-slash-commands" class="anchor" href="#custom-slash-commands"><span class="octicon octicon-link"></span></a>Custom Slash Commands</h3>

<pre><code>/cancel
/finish
/fm
/official
/pause
/resume
/spawn
</code></pre>

<p>/cancel</p>

<ul>
<li><p>Permission Requirement: Spawn &amp; Non-observer</p></li>
<li><p>Description: Cancel the current match whether it's official or for fun. If this command is used during an official match, it will cancel the match and will <em>not</em> report the match to the league website.</p></li>
</ul><p>/finish</p>

<ul>
<li><p>Permission Requirement: Spawn &amp; Non-observer</p></li>
<li><p>Description: This command will only functional during an official match and the match <em>will</em> be reported to the league website.</p></li>
</ul><p>/fm</p>

<ul>
<li><p>Permission Requirement: Spawn &amp; Non-observer</p></li>
<li><p>Description: This command will start a fun match.</p></li>
</ul><p>/official</p>

<ul>
<li><p>Permission Requirement: Spawn &amp; Non-observer</p></li>
<li><p>Description: This command will start an official match</p></li>
</ul><p>/pause</p>

<ul>
<li><p>Permission Requirement: Spawn</p></li>
<li><p>Description: This command is only functional during a match; it will pause the match.</p></li>
</ul><p>/resume</p>

<ul>
<li><p>Permission Requirement: Spawn</p></li>
<li><p>Description: This command is only functional during a paused match; it will resume the match after it has been paused.</p></li>
</ul><p>/spawn</p>

<ul>
<li><p>Permission Requirement: Ban</p></li>
<li><p>Description: This command allows you to grant the spawn permission to any players that are on the server</p></li>
</ul><h3>
<a name="deprecated-features" class="anchor" href="#deprecated-features"><span class="octicon octicon-link"></span></a>Deprecated Features</h3>

<p>With this plugin loaded, there is no need for /countdown or /gameover and it is highly recommended that you remove these permissions from the group permissions file in order to avoid confusion. Any matches started with /countdown or ended with /gameover will not be handled by the plugin and therefore should not be allowed on match servers.</p>

<p>This plugin also replaces the need for the RecordMatch plugin as this plugin already records all matches automatically and names the replays respectively.</p>

<h3>
<a name="configuration-file-options" class="anchor" href="#configuration-file-options"><span class="octicon octicon-link"></span></a>Configuration File Options</h3>

<p>ROTATIONAL_LEAGUE</p>

<ul>
<li><p>Default: <em>false</em></p></li>
<li><p>Description:  If a league uses different maps for its matches (such as Open League) then make sure that this value is set to 'true' and if the league is GU or Ducati, then set the value to 'false'</p></li>
</ul><p>MAPCHANGE_PATH</p>

<ul>
<li><p>Default: <em>N/A</em></p></li>
<li><p>Description: If this is a rotational league, then be sure to change the path to the mapchange.out file because that is where the name of the map file is stored. Whatever is located in this file is what will be submitted as the map played. If this is not a rotational, then this variable can be left with the current value or commented out.</p></li>
</ul><p>DISABLE_MATCH_REPORT</p>

<ul>
<li><p>Default: <em>false</em></p></li>
<li><p>Description: Disable automatically submitting matches when the <code>/official</code> command is issued. Use this option when running a server that will not be reporting matches to the league website.</p></li>
</ul><p>DISABLE_TEAM_MOTTO</p>

<ul>
<li><p>Default: <em>false</em></p></li>
<li><p>Description: Disable fetching team names and setting the team names as the mottos for players when they join. Use this option if you would like to allow players to use their own mottos when joining a league server.</p></li>
</ul><p>LEAGUE_OVERSEER_URL</p>

<ul>
<li><p>Default: <em>N/A</em></p></li>
<li><p>Description: The URL the plugin will be using for <strong>both</strong> automatic match reports and the team name fetching for replacing a player's motto. When this option is used, it will automatically set <code>AUTO_REPORT_URL</code> and <code>MOTTO_FETCH_URL</code> to the same value.</p></li>
</ul><p>MATCH_REPORT_URL</p>

<ul>
<li><p>Default: <em>N/A</em></p></li>
<li><p>Description: The URL the plugin will be using <strong>only</strong> to report matches. This option can be used if the plugin will not be reporting matches to a league website but instead to a custom script for a custom tournament.</p></li>
</ul><p>MOTTO_FETCH_URL</p>

<ul>
<li><p>Default: <em>N/A</em></p></li>
<li><p>Description: The URL the plugin will be using <strong>only</strong> to fetch team names for players' mottos. If the plugin is running a custom tournament and is reporting to a custom script, then this URL will be set to the actual league site in order to fetch the correct team names.</p></li>
</ul><p>DEBUG_LEVEL</p>

<ul>
<li><p>Default: <em>1</em></p></li>
<li><p>Description: The debug level that will be used by the plugin to report some information on who started a match, who canceled a match, what teams played, etc.</p></li>
</ul><p>VERBOSE_LEVEL</p>

<ul>
<li><p>Default: <em>4</em></p></li>
<li><p>Description: This option is not in the sample configuration and should not really be used on a live server as there is no need for it. This option only exists in need of debugging purposes where this is the debug level the plugin will use for <strong>all</strong> of the extra information the plugin received and how it is handled; this value is separate and does <strong>not</strong> overwrite the <code>DEBUG_LEVEL</code> value. <em>Warning:</em> Your log file will be much larger if this value is set appropriately.</p></li>
</ul><h2>
<a name="league-websites" class="anchor" href="#league-websites"><span class="octicon octicon-link"></span></a>League Websites</h2>

<h3>
<a name="bzion" class="anchor" href="#bzion"><span class="octicon octicon-link"></span></a>BZiON</h3>

<p>The <a href="http://github.com/allejo/bzion">BZiON</a> project supports League Overseer automatically and does not require the leagueOverSeer.php file, instead read BZiON's documentation to learn how to configure accepting automatic match reports.</p>

<h3>
<a name="bz-owl" class="anchor" href="#bz-owl"><span class="octicon octicon-link"></span></a>bz-owl</h3>

<p>If you are hosting a league website using the <a href="https://code.google.com/p/bz-owl/">bz-owl</a> project, make sure you follow these requirements:</p>

<ol>
<li><p>Upload leagueOverSeer.php to the root of your league website directory.</p></li>
<li><p>Add the IPs of the official match servers to the $ALLOWED_IPS array located on line 27 of leagueOverSeer.php. This is a precaution so only official match servers can report matches and access data.</p></li>
<li><p>Set $AUTOREPORT_UID on line 31 to the user ID of the person who will be reporting the matches. For instance, you may want to create an 'autoreport' account on the league website and use that ID.</p></li>
<li><p>If you would like for the report handler to output match information received to a file, leave $LOG_DETAILS (line 35) set to <em>true</em> and set the file location with the $LOG_FILE variable on line 39. If you do not wish to log, set $LOG_DETAILS to false and leave $LOG_FILE as is.</p></li>
<li><p>Since all leagues have different scoring systems, configure line 49 to use the respective fractions of ELOs with their match durations. By default, GU league uses the 2/3 of the ELO points for 20 minute matches and all of the ELO points for 30 minute matches. This looks like: <code>array(20 =&gt; 2/3, 30 =&gt; 1)</code></p></li>
</ol><h3>
<a name="custom-script" class="anchor" href="#custom-script"><span class="octicon octicon-link"></span></a>Custom Script</h3>

<p>If you would like to host your own tournament using the League Overseer plugin, you may write your own script on a webserver to handle match reports from the plugin automatically. The plugin submits information via POST requests and the information submitted are the following:</p>

<p>query</p>

<ul>
<li>The request the plugin is submitting. When submitting a match report, this value is set to <code>reportMatch</code>.</li>
</ul><p>apiVersion</p>

<ul>
<li>The API version the BZFS plugin is using when submitting information. The current API version is set to 1.</li>
</ul><p>teamOneWins</p>

<ul>
<li>The number of times Team A captured the flag in the official match.</li>
</ul><p>teamTwoWins</p>

<ul>
<li>The number of times Team B captured the flag in the official match.</li>
</ul><p>duration</p>

<ul>
<li>The duration of the match in minutes.</li>
</ul><p>matchTime</p>

<ul>
<li>The UTC timestamp of when the match was submitted</li>
</ul><p>server</p>

<ul>
<li>The domain name of the server where the match took place.</li>
</ul><p>port</p>

<ul>
<li>The port of the server where the match took place.</li>
</ul><p>replayFile</p>

<ul>
<li>The name of the report file saved on the server.</li>
</ul><p>mapPlayed</p>

<ul>
<li>The name of the map that was played on. This value is only applicable to rotational leagues.</li>
</ul><p>teamOnePlayers</p>

<ul>
<li>A list of BZIDs separated by commas of the players who participated on Team A.</li>
</ul><p>teamTwoPlayers</p>

<ul>
<li>A list of BZIDs separated by commas of the players who participated on Team B.</li>
</ul><h2>
<a name="code-hosting" class="anchor" href="#code-hosting"><span class="octicon octicon-link"></span></a>Code Hosting</h2>

<p>The code for this plug-in can be found both on <a href="https://github.com/allejo/leagueOverSeer">GitHub</a> and <a href="https://bitbucket.org/allejo/leagueoverseer">BitBucket</a> in order to satisfy any preferences a person may have and to have a backup in the case one service would have downtime; both services are synced and have the same code. GitHub is the official code repository so please direct all issues and pull requests there; anything submitted to BitBucket will be ignored.</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p><a href="https://github.com/allejo/leagueOverSeer/blob/master/LICENSE.markdown">GNU General Public License Version 3.0</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/allejo/leagueOverSeer/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/allejo/leagueOverSeer/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/allejo/leagueOverSeer"></a> is maintained by <a href="https://github.com/allejo">allejo</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>